テストを必要に応じてスキップする方法やJUNITのみの実行時間を確認する方法はいくつかあります。以下の2つの方法で対処できます。

1. テストのスキップをオプション化する

パラメータとして「テストをスキップするかどうか」を設定し、パイプライン実行時に選択できるようにします。

parameters {
    booleanParam(name: "SKIP_TESTS", defaultValue: false, description: 'テストをスキップするかどうか')
}

その後、Main-Buildステージのテスト実行部分を以下のように変更します。

stage('Main-Build') {
    steps {
        withCredentials([usernamePassword(credentialsId: "${SONAR_CREDENTIALS_ID}", passwordVariable: "SONAR_PASSWORD", usernameVariable: "SONAR_USERNAME")]) {
            sh """ 
                mvn clean \
                ${params.SKIP_TESTS ? '-DskipTests=true' : 'test'} \
                package \
                checkstyle:checkstyle \
                pmd:pmd \
                pmd:cpd \
                surefire-report:report \
                sonar:sonar \
                -f ${POM_BASE_COMSRV_PARENT} \
                --global-settings ${GLOBAL_SETTINGS} \
                -Dsonar.login=${SONAR_USERNAME} \
                -Dsonar.password=${SONAR_PASSWORD} \
                -Dsonar.projectName=${JOB_BASE_NAME}
            """
        }
    }
}

この変更により、パイプライン実行時にSKIP_TESTSオプションをtrueに設定することで、テストをスキップできます。

2. JUNITのみの実行時間を知りたい場合

Main-Buildステージをテストのみ実行するようにして、ビルドプロセスやその他のチェックを省略することで、JUNITのみの実行時間を測定できます。以下のように変更します。

stage('Main-Build-Test-Only') {
    steps {
        sh """
            mvn clean test -f ${POM_BASE_COMSRV_PARENT} --global-settings ${GLOBAL_SETTINGS}
        """
    }
}

この変更を一時的にパイプラインに追加して実行し、JUNITテストの実行時間を測定できます。その後、測定が完了したら元に戻せば他のビルド・デプロイプロセスに影響しません。